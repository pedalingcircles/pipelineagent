parameters:
- name: sandboxSteps
  type: stepList
  default: []
- name: productionSteps
  type: stepList
  default: []

stages:
- stage: stageSandbox
  displayName: Deploying Sandbox
  jobs:
  - deployment: provisionInfra
    displayName: Provision Infrastructure
    environment: 'pipeline-images-sandbox'
    variables:
    - template: /.azure/pipelines/templates/variables-config-sbx.yml
    strategy:
      runOnce:
        deploy:
          steps:
          - ${{ each step in parameters.sandboxSteps }}:
            - ${{ step }}

- stage: stageProduction
  displayName: Deploying Production
  dependsOn: stageSandbox
  jobs:
  - deployment: provisionInfra
    displayName: Provision Infrastructure
    environment: 'pipeline-images-production'
    variables:
    - template: /.azure/pipelines/templates/variables-config-prd.yml
    strategy:
      runOnce:
        deploy:
          steps:
          - ${{ each step in parameters.productionSteps }}:
            - ${{ step }}